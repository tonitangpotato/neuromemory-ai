meta:
  version: '2.0'
  domain: engram
  schema:
    relations:
      code:
        - implements
        - depends_on
      semantic:
        - enables
        - blocks
        - requires
        - related_to
        - decided_by
    discovered: []

nodes:
  # ══════════════════════════════════════
  # PHASE 0: Project Setup ✅ COMPLETE
  # ══════════════════════════════════════
  phase-0:
    type: Feature
    layer: application
    status: active
    description: "Phase 0: Project restructure — convert prototype into proper Python package"

  task-package-structure:
    type: Component
    layer: application
    status: active
    description: "engram/ package with __init__.py, pyproject.toml, proper imports"

  task-sqlite-store:
    type: Component
    layer: infrastructure
    status: active
    description: "SQLite backend with WAL mode, FTS5, access_log, graph_links tables"

  task-fts5-index:
    type: Component
    layer: infrastructure
    status: active
    description: "FTS5 virtual table with triggers for auto-sync on INSERT/UPDATE/DELETE"

  task-migrate-tests:
    type: Test
    layer: application
    status: active
    description: "9 original tests migrated to engram package imports, all passing"

  # ══════════════════════════════════════
  # PHASE 1: Core Library ✅ MOSTLY COMPLETE
  # ══════════════════════════════════════
  phase-1:
    type: Feature
    layer: application
    status: active
    description: "Phase 1: engram-core library — pip-installable with clean API"

  feat-activation:
    type: Component
    layer: application
    status: active
    description: "ACT-R activation-based retrieval — base-level activation, spreading activation, retrieval scoring"

  feat-consolidation:
    type: Component
    layer: application
    status: active
    description: "Memory Chain consolidation with store.update() persistence, layer promotion/demotion"

  feat-forgetting:
    type: Component
    layer: application
    status: active
    description: "Ebbinghaus forgetting curve, spaced repetition stability, retrieval-induced forgetting"

  feat-search:
    type: Component
    layer: application
    status: active
    description: "Hybrid search: FTS5 + graph entity expansion + ACT-R scoring + SQL filtering. Known limitation: FTS5 Chinese tokenization needs improvement."

  feat-confidence:
    type: Component
    layer: application
    status: active
    description: "Two-dimensional metacognition: content reliability (stable) + retrieval salience (decays). Old memories are reliable but low-salience, not 'uncertain'."

  feat-reward:
    type: Component
    layer: application
    status: active
    description: "Bilingual feedback detection (EN+CN), dopaminergic reward with temporal discount eligibility traces"

  feat-downscaling:
    type: Component
    layer: application
    status: active
    description: "Synaptic homeostasis (Tononi & Cirelli SHY). Proportional strength reduction, pinned exempt."

  feat-anomaly:
    type: Component
    layer: application
    status: active
    description: "BaselineTracker with rolling window statistics and 2σ anomaly detection"

  feat-graph-index:
    type: Component
    layer: application
    status: active
    description: "Graph-based entity linking and retrieval. Entities stored in graph_links table, multi-hop traversal via shared memories. Entity extraction done by agent (LLM), library stores/queries."

  feat-hebbian:
    type: Component
    layer: application
    status: in_progress
    description: "Hebbian learning: 'neurons that fire together wire together'. Memories co-activated during recall automatically form links after threshold. Emergent structure without manual entity tagging."

  feat-api:
    type: Component
    layer: application
    status: active
    description: "Memory class: add(), recall(), consolidate(), forget(), reward(), downscale(), stats(), export(), pin()/unpin()"

  feat-portability:
    type: Component
    layer: application
    status: active
    priority: core
    description: "Single .db file export/import. Agent memory is portable — copy one file."

  feat-contradiction:
    type: Component
    layer: application
    status: active
    description: "Contradiction detection: memories can link as contradicts/contradicted_by, contradicted memories get 0.3x confidence penalty, update_memory() creates correction chains"

  test-core:
    type: Test
    layer: application
    status: active
    description: "68 tests across 10 categories: store, activation, consolidation, forgetting, confidence, reward, downscaling, anomaly, contradiction, integration"

  # ══════════════════════════════════════
  # PHASE 2: MCP Server ✅ COMPLETE
  # ══════════════════════════════════════
  phase-2:
    type: Feature
    layer: application
    status: active
    description: "Phase 2: MCP server — 7 tools via FastMCP, JSON-RPC over stdio"

  feat-mcp-server:
    type: Component
    layer: interface
    status: active
    description: "MCP server: engram.store, engram.recall, engram.consolidate, engram.forget, engram.reward, engram.stats, engram.export"

  # ══════════════════════════════════════
  # PHASE 3: Clawdbot Integration ✅ COMPLETE
  # ══════════════════════════════════════
  phase-3:
    type: Feature
    layer: application
    status: active
    description: "Phase 3: Clawdbot skill with CLI, SKILL.md, and migration tool"

  feat-clawdbot-skill:
    type: Component
    layer: application
    status: active
    description: "SKILL.md + engram-cli.py (all commands) + migrate-memory.py (635 entries found in test)"

  feat-migration:
    type: Component
    layer: application
    status: active
    description: "migrate-memory.py: parses MEMORY.md + daily notes, classifies into 6 types, imports to .db"

  # ══════════════════════════════════════
  # TODO: Parameter Configuration
  # ══════════════════════════════════════
  feat-config:
    type: Feature
    layer: application
    status: draft
    description: "Extract all hardcoded parameters into config. Three layers: configurable defaults (from literature), presets (chatbot/task-agent/personal-assistant/researcher), adaptive tuning (future)."

  feat-presets:
    type: Component
    layer: application
    status: draft
    description: "Pre-tuned parameter sets for agent archetypes: chatbot, task-agent, personal-assistant, researcher"

  feat-adaptive-tuning:
    type: Component
    layer: application
    status: draft
    description: "Self-adjusting parameters based on recall hit rate, reward feedback, miss rate. Paper contribution point."

  # ══════════════════════════════════════
  # PHASE 4: Paper + Launch (TODO)
  # ══════════════════════════════════════
  phase-4:
    type: Feature
    layer: application
    status: draft
    description: "Phase 4: arXiv paper + open source launch + Show HN"

  task-paper:
    type: Component
    layer: interface
    status: draft
    description: "arXiv paper: 'Engram: Computational Neuroscience Models for Agent Memory' — math foundations, two-dim confidence, benchmarks"

  task-pypi:
    type: Component
    layer: infrastructure
    status: draft
    description: "Publish to PyPI — pip install engram"

  task-github:
    type: Component
    layer: interface
    status: active
    description: "README.md, LICENSE (Apache 2.0), .gitignore, pyproject.toml, examples/ — ready for GitHub"

  task-launch:
    type: Component
    layer: interface
    status: draft
    description: "Show HN + Product Hunt + dev blog post"

  # ══════════════════════════════════════
  # DECISIONS
  # ══════════════════════════════════════
  decision-positioning:
    type: Decision
    layer: domain
    status: active
    description: "Not anti-vector, anti-naive-embedding-search. Hopfield networks are theoretical support for the paper, not a feature to implement. Engram paired with LLM doesn't need embedding."

  decision-no-embedding-v1:
    type: Decision
    layer: domain
    status: active
    description: "v1 does not include embeddings. LLM is the semantic layer. FTS5 + ACT-R + graph is sufficient."

  decision-sqlite-storage:
    type: Decision
    layer: domain
    status: active
    description: "SQLite + FTS5 as sole storage. Single .db file per agent. Zero external dependencies."

  decision-local-first:
    type: Decision
    layer: domain
    status: active
    description: "Local-first architecture. Everything runs on user's machine. Cloud is future upsell."

  decision-open-core:
    type: Decision
    layer: domain
    status: active
    description: "Open-core business model. Library free + open source. Revenue from cloud sync, teams, enterprise."

  decision-two-dim-confidence:
    type: Decision
    layer: domain
    status: active
    description: "Confidence must separate reliability (content accuracy, stable) from salience (retrieval strength, decays). Old facts don't become less true."

  decision-agent-extracts-entities:
    type: Decision
    layer: domain
    status: active
    description: "Entity extraction is done by the agent (LLM), not the library. Library provides graph storage + query APIs. No LLM dependency in engram-core."

  decision-no-ner:
    type: Decision
    layer: domain
    status: active
    description: "No bundled NER (unlike shodh-memory). Reasons: (1) LLM already understands semantics better than TinyBERT, (2) Hebbian learning provides emergent structure without NER, (3) preserves zero-dependency philosophy."

  decision-llm-native:
    type: Decision
    layer: domain
    status: active
    description: "engram is designed for LLM agents, not standalone. Philosophy: 'LLM is the semantic layer, engram is the dynamics layer'. Don't duplicate what LLM already does well."

  # ══════════════════════════════════════
  # ADVANCED TESTING SUITE
  # ══════════════════════════════════════
  advanced-testing:
    type: Feature
    layer: application
    status: in_progress
    description: "Comprehensive testing: long-term sim, psychology experiments, real conversations, stress testing"

  test-long-term:
    type: Component
    layer: application
    status: draft
    description: "1-year (365 days) simulation: memory plateau, important memory persistence, latency trends"

  test-psychology:
    type: Component
    layer: application
    status: draft
    description: "Psychology experiment replication: serial position, spacing effect, testing effect, forgetting curve, emotional enhancement"

  test-real-conversations:
    type: Component
    layer: application
    status: draft
    description: "Real conversation patterns: multi-session recall, preference learning, context switching"

  test-stress:
    type: Component
    layer: application
    status: draft
    description: "Stress testing: 100k memories, continuous writes, burst handling, large DB files"

edges:
  # Phase 0 tasks
  - from: task-package-structure
    to: phase-0
    relation: implements
  - from: task-sqlite-store
    to: phase-0
    relation: implements
  - from: task-fts5-index
    to: phase-0
    relation: implements
  - from: task-migrate-tests
    to: phase-0
    relation: implements
  - from: task-fts5-index
    to: task-sqlite-store
    relation: depends_on
  - from: task-migrate-tests
    to: task-sqlite-store
    relation: depends_on

  # Phase 1 depends on Phase 0
  - from: phase-1
    to: phase-0
    relation: depends_on

  # Phase 1 features
  - from: feat-activation
    to: phase-1
    relation: implements
  - from: feat-consolidation
    to: phase-1
    relation: implements
  - from: feat-forgetting
    to: phase-1
    relation: implements
  - from: feat-search
    to: phase-1
    relation: implements
  - from: feat-confidence
    to: phase-1
    relation: implements
  - from: feat-reward
    to: phase-1
    relation: implements
  - from: feat-downscaling
    to: phase-1
    relation: implements
  - from: feat-anomaly
    to: phase-1
    relation: implements
  - from: feat-graph-index
    to: phase-1
    relation: implements
  - from: feat-api
    to: phase-1
    relation: implements
  - from: feat-portability
    to: phase-1
    relation: implements
  - from: test-core
    to: phase-1
    relation: implements

  - from: feat-contradiction
    to: phase-1
    relation: implements
  - from: feat-contradiction
    to: feat-confidence
    relation: depends_on

  # Phase 1 internal dependencies
  - from: feat-search
    to: feat-activation
    relation: depends_on
  - from: feat-search
    to: task-fts5-index
    relation: depends_on
  - from: feat-search
    to: feat-graph-index
    relation: depends_on
  - from: feat-confidence
    to: feat-forgetting
    relation: depends_on
  - from: feat-api
    to: feat-search
    relation: depends_on
  - from: feat-api
    to: feat-consolidation
    relation: depends_on
  - from: feat-api
    to: feat-confidence
    relation: depends_on
  - from: feat-portability
    to: task-sqlite-store
    relation: depends_on
  - from: feat-graph-index
    to: task-sqlite-store
    relation: depends_on
  - from: test-core
    to: feat-api
    relation: depends_on

  # Decision links
  - from: feat-search
    to: decision-no-embedding-v1
    relation: decided_by
  - from: task-sqlite-store
    to: decision-sqlite-storage
    relation: decided_by
  - from: feat-confidence
    to: decision-two-dim-confidence
    relation: decided_by
  - from: feat-graph-index
    to: decision-agent-extracts-entities
    relation: decided_by
  - from: decision-no-embedding-v1
    to: decision-positioning
    relation: decided_by

  # Hebbian learning
  - from: feat-hebbian
    to: phase-1
    relation: implements
  - from: feat-hebbian
    to: feat-search
    relation: enables
  - from: feat-hebbian
    to: decision-no-ner
    relation: decided_by
  - from: decision-no-ner
    to: decision-llm-native
    relation: decided_by

  # Phase 2 depends on Phase 1
  - from: phase-2
    to: phase-1
    relation: depends_on
  - from: feat-mcp-server
    to: phase-2
    relation: implements
  - from: feat-mcp-server
    to: feat-api
    relation: depends_on

  # Phase 3 depends on Phase 1
  - from: phase-3
    to: phase-1
    relation: depends_on
  - from: feat-clawdbot-skill
    to: phase-3
    relation: implements
  - from: feat-migration
    to: phase-3
    relation: implements
  - from: feat-clawdbot-skill
    to: feat-api
    relation: depends_on
  - from: feat-migration
    to: feat-portability
    relation: depends_on

  # Parameter config
  - from: feat-presets
    to: feat-config
    relation: implements
  - from: feat-adaptive-tuning
    to: feat-config
    relation: implements
  - from: feat-config
    to: feat-api
    relation: depends_on

  # Phase 4 depends on everything
  - from: phase-4
    to: phase-2
    relation: depends_on
  - from: phase-4
    to: phase-3
    relation: depends_on
  - from: task-paper
    to: phase-4
    relation: implements
  - from: task-pypi
    to: phase-4
    relation: implements
  - from: task-github
    to: phase-4
    relation: implements
  - from: task-launch
    to: phase-4
    relation: implements
  - from: task-paper
    to: test-core
    relation: depends_on
  - from: task-pypi
    to: feat-api
    relation: depends_on
  - from: feat-api
    to: decision-local-first
    relation: decided_by
  - from: feat-api
    to: decision-open-core
    relation: decided_by

  # Advanced testing suite
  - from: test-long-term
    to: advanced-testing
    relation: implements
  - from: test-psychology
    to: advanced-testing
    relation: implements
  - from: test-real-conversations
    to: advanced-testing
    relation: implements
  - from: test-stress
    to: advanced-testing
    relation: implements
  - from: advanced-testing
    to: phase-1
    relation: depends_on
  - from: task-paper
    to: test-psychology
    relation: depends_on
